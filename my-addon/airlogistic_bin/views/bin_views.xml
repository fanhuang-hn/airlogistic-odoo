<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Bin List View -->
        <record id="view_airlogistic_bin_tree" model="ir.ui.view">
            <field name="name">airlogistic.bin.tree</field>
            <field name="model">airlogistic.bin</field>
            <field name="arch" type="xml">
                <list string="Bin Containers" 
                      decoration-success="state=='available'" 
                      decoration-info="state=='assigned'"
                      decoration-warning="state in ['loaded', 'in_transit']"
                      decoration-danger="is_overloaded==True"
                      decoration-muted="state=='maintenance'">
                    <field name="bin_code"/>
                    <field name="bin_type"/>
                    <field name="bin_subtype" optional="show"/>
                    <field name="volume"/>
                    <field name="max_weight"/>
                    <field name="current_weight"/>
                    <field name="available_weight"/>
                    <field name="weight_utilization" widget="percentage"/>
                    <field name="flight_id"/>
                    <field name="flight_number" optional="show"/>
                    <field name="state" widget="label_selection"/>
                    <field name="is_overloaded" invisible="1"/>
                    <button name="action_assign_to_flight" type="object" 
                            icon="fa-plane" title="Assign to Flight"
                           />
                    <button name="action_unassign_from_flight" type="object" 
                            icon="fa-unlink" title="Unassign from Flight"
                           />
                    <field name="flight_state" invisible="1"/>
                </list>
            </field>
        </record>
        
        <!-- Bin Form View -->
        <record id="view_airlogistic_bin_form" model="ir.ui.view">
            <field name="name">airlogistic.bin.form</field>
            <field name="model">airlogistic.bin</field>
            <field name="arch" type="xml">
                <form string="Bin Container">
                    <header>
                        <button name="action_assign_to_flight" type="object" string="Assign to Flight" 
                                class="btn-primary" 
                               />
                        <button name="action_unassign_from_flight" type="object" string="Unassign from Flight" 
                               />
                        <button name="action_reset_weight" type="object" string="Reset Weight" 
                               />
                        <button name="action_set_maintenance" type="object" string="Set Maintenance" 
                               />
                        <field name="state" widget="statusbar" 
                               statusbar_visible="available,assigned,loaded,in_transit,delivered"/>
                    </header>
                    <sheet>
                        <!-- Weight overload alert -->
                        <div class="alert alert-danger" role="alert" 
                            >
                            <strong>Weight Overload Warning!</strong> 
                            Current weight (<field name="current_weight" readonly="1"/>) exceeds maximum capacity (<field name="max_weight" readonly="1"/>).
                        </div>
                        
                        <!-- Flight departure warning -->
                        <div class="alert alert-warning" role="alert" 
                            >
                            <strong>Flight Departed!</strong> 
                            This bin is assigned to flight <field name="flight_number" readonly="1"/> which has already departed. Modifications are not allowed.
                        </div>
                        
                        <div class="oe_title">
                            <h1>
                                <field name="bin_code" placeholder="Bin Code (e.g., ULD-LD3-001)"/>
                            </h1>
                            <h3>
                                <field name="name" readonly="1"/>
                            </h3>
                        </div>
                        
                        <group>
                            <group string="Bin Information">
                                <field name="bin_type"/>
                                <field name="bin_subtype"/>
                                <field name="barcode"/>
                                <field name="qr_code"/>
                            </group>
                            <group string="Physical Specifications">
                                <field name="volume"/>
                                <field name="max_weight"/>
                                <field name="length"/>
                                <field name="width"/>
                                <field name="height"/>
                            </group>
                        </group>
                        
                        <group>
                            <group string="Weight Management">
                                <field name="current_weight" 
                                      />
                                <field name="available_weight"/>
                                <field name="weight_utilization" widget="percentage"/>
                                <field name="is_overloaded" readonly="1"/>
                            </group>
                            <group string="Flight Assignment">
                                <field name="flight_id" 
                                      />
                                <field name="flight_number" readonly="1"/>
                                <field name="flight_state" invisible="1"/>
                            </group>
                        </group>
                        
                        <group>
                            <group string="Location">
                                <field name="current_location"/>
                            </group>
                            <group string="Maintenance">
                                <field name="last_maintenance_date"/>
                                <field name="next_maintenance_date"/>
                                <field name="certification_expiry"/>
                            </group>
                        </group>
                        
                        <group string="Description">
                            <field name="description" nolabel="1"/>
                        </group>

                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
        
        <!-- Bin Kanban View -->
        <record id="view_airlogistic_bin_kanban" model="ir.ui.view">
            <field name="name">airlogistic.bin.kanban</field>
            <field name="model">airlogistic.bin</field>
            <field name="arch" type="xml">
                <kanban default_group_by="state" class="o_kanban_small_column">
                    <field name="bin_code"/>
                    <field name="bin_type"/>
                    <field name="volume"/>
                    <field name="max_weight"/>
                    <field name="current_weight"/>
                    <field name="weight_utilization"/>
                    <field name="flight_id"/>
                    <field name="flight_number"/>
                    <field name="state"/>
                    <field name="is_overloaded"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_card oe_kanban_global_click">
                                <div class="o_kanban_image_fill_left" 
                                     t-attf-style="background-color: #{kanban_color(is_overloaded and 'red' or state == 'available' and 'green' or 'blue')};">
                                    <i class="fa fa-cube fa-2x text-white"/>
                                </div>
                                <div class="oe_kanban_details">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="bin_code"/>
                                            </strong>
                                            <br/>
                                            <small class="o_kanban_record_subtitle text-muted">
                                                <field name="bin_type"/>
                                            </small>
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <div class="text-muted">
                                            <i class="fa fa-cube"/> <field name="volume"/> mÂ³
                                        </div>
                                        <div class="text-muted">
                                            <i class="fa fa-balance-scale"/> 
                                            <field name="current_weight"/>/<field name="max_weight"/> kg
                                        </div>
                                        <div t-if="flight_id" class="text-muted">
                                            <i class="fa fa-plane"/> <field name="flight_number"/>
                                        </div>
                                        <div class="mt4">
                                            <span class="badge badge-pill" 
                                                  t-attf-class="badge-#{weight_utilization >= 100 and 'danger' or weight_utilization >= 80 and 'warning' or 'success'}">
                                                <field name="weight_utilization" widget="percentage"/>
                                            </span>
                                        </div>
                                        <div t-if="is_overloaded" class="mt8">
                                            <span class="badge badge-danger">
                                                <i class="fa fa-exclamation-triangle"/> Overloaded!
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        
        <!-- Bin Search View -->
        <record id="view_airlogistic_bin_search" model="ir.ui.view">
            <field name="name">airlogistic.bin.search</field>
            <field name="model">airlogistic.bin</field>
            <field name="arch" type="xml">
                <search string="Search Bins">
                    <field name="bin_code" string="Bin Code"/>
                    <field name="bin_type" string="Type"/>
                    <field name="bin_subtype" string="Subtype"/>
                    <field name="flight_id" string="Flight"/>
                    <field name="current_location" string="Location"/>
                    <separator/>
                    <filter name="available" string="Available" domain="[('state', '=', 'available')]"/>
                    <filter name="assigned" string="Assigned" domain="[('state', '=', 'assigned')]"/>
                    <filter name="loaded" string="Loaded" domain="[('state', '=', 'loaded')]"/>
                    <filter name="in_transit" string="In Transit" domain="[('state', '=', 'in_transit')]"/>
                    <filter name="maintenance" string="Maintenance" domain="[('state', '=', 'maintenance')]"/>
                    <separator/>
                    <filter name="overloaded" string="Overloaded" domain="[('is_overloaded', '=', True)]"/>
                    <filter name="has_flight" string="Has Flight Assignment" domain="[('flight_id', '!=', False)]"/>
                    <separator/>
                    <filter name="uld" string="ULD" domain="[('bin_type', '=', 'uld')]"/>
                    <filter name="pallet" string="Pallet" domain="[('bin_type', '=', 'pallet')]"/>
                    <filter name="container" string="Container" domain="[('bin_type', '=', 'container')]"/>
                    <separator/>
                    <group expand="0" string="Group By">
                        <filter name="group_by_state" string="Status" context="{'group_by': 'state'}"/>
                        <filter name="group_by_type" string="Bin Type" context="{'group_by': 'bin_type'}"/>
                        <filter name="group_by_flight" string="Flight" context="{'group_by': 'flight_id'}"/>
                        <filter name="group_by_location" string="Location" context="{'group_by': 'current_location'}"/>
                    </group>
                </search>
            </field>
        </record>
        
    </data>
</odoo>