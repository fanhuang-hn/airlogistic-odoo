# Copilot Instructions - Odoo Addon Development

## Project Overview
This is an Odoo 18.0 development environment using Docker Compose. All custom addons should be developed in the `my-addon/` directory.

## Development Environment
- **Odoo Version:** 18.0
- **Python Version:** 3.11+
- **Database:** PostgreSQL 13
- **Custom Addons Path:** `./my-addon/`
- **Community Addons Path:** `./addons/helpdesk/`

## Addon Structure Guidelines

### Standard Addon Structure
```
my-addon/
├── addon_name/
│   ├── __init__.py
│   ├── __manifest__.py
│   ├── models/
│   │   ├── __init__.py
│   │   └── model_name.py
│   ├── views/
│   │   ├── model_name_views.xml
│   │   └── menu_views.xml
│   ├── security/
│   │   ├── ir.model.access.csv
│   │   └── security_groups.xml
│   ├── data/
│   │   └── default_data.xml
│   ├── demo/
│   │   └── demo_data.xml
│   ├── static/
│   │   ├── description/
│   │   │   ├── icon.png
│   │   │   └── index.html
│   │   ├── src/
│   │   │   ├── css/
│   │   │   ├── js/
│   │   │   └── xml/
│   ├── wizard/
│   │   ├── __init__.py
│   │   └── wizard_name.py
│   ├── report/
│   │   ├── __init__.py
│   │   └── report_name.py
│   └── controllers/
│       ├── __init__.py
│       └── main.py
```

### Manifest File Template
Always use this template for `__manifest__.py`:

```python
{
    'name': 'Addon Name',
    'version': '18.0.1.0.0',
    'category': 'Category Name',
    'summary': 'Short description',
    'description': """
        Long description of the addon functionality.
    """,
    'author': 'Your Name',
    'website': 'https://your-website.com',
    'license': 'LGPL-3',
    'depends': ['base', 'mail'],  # Add dependencies here
    'data': [
        'security/ir.model.access.csv',
        'views/menu_views.xml',
        'views/model_views.xml',
        'data/default_data.xml',
    ],
    'demo': [
        'demo/demo_data.xml',
    ],
    'assets': {
        'web.assets_backend': [
            'addon_name/static/src/css/**/*',
            'addon_name/static/src/js/**/*',
        ],
    },
    'installable': True,
    'auto_install': False,
    'application': False,  # Set to True for main applications
}
```

## Coding Standards

### Python Code Guidelines
1. **Imports:** Always import Odoo modules in this order:
   ```python
   from odoo import models, fields, api, _
   from odoo.exceptions import UserError, ValidationError
   ```

2. **Model Structure:**
   ```python
   class ModelName(models.Model):
       _name = 'model.name'
       _description = 'Model Description'
       _inherit = ['mail.thread', 'mail.activity.mixin']  # If needed
       _order = 'name'
       
       # Fields
       name = fields.Char('Name', required=True, tracking=True)
       active = fields.Boolean('Active', default=True)
       
       # Compute methods
       @api.depends('field_name')
       def _compute_something(self):
           for record in self:
               record.computed_field = some_computation
       
       # Constrains
       @api.constrains('field_name')
       def _check_something(self):
           for record in self:
               if not condition:
                   raise ValidationError(_('Error message'))
       
       # Actions
       def action_confirm(self):
           self.ensure_one()
           # Action logic here
   ```

3. **Field Types Common Usage:**
   ```python
   # Basic fields
   name = fields.Char('Name', required=True, tracking=True)
   description = fields.Text('Description')
   active = fields.Boolean('Active', default=True)
   sequence = fields.Integer('Sequence', default=10)
   amount = fields.Float('Amount', digits='Product Price')
   
   # Selection field
   state = fields.Selection([
       ('draft', 'Draft'),
       ('confirmed', 'Confirmed'),
       ('done', 'Done'),
   ], string='Status', default='draft', tracking=True)
   
   # Relational fields
   partner_id = fields.Many2one('res.partner', 'Customer', required=True)
   line_ids = fields.One2many('model.line', 'header_id', 'Lines')
   tag_ids = fields.Many2many('model.tag', string='Tags')
   
   # Computed fields
   total_amount = fields.Float('Total', compute='_compute_total', store=True)
   ```

### XML Views Guidelines

1. **List View Template:**
   ```xml
   <record id="view_model_tree" model="ir.ui.view">
       <field name="name">model.name.tree</field>
       <field name="model">model.name</field>
       <field name="arch" type="xml">
           <tree string="Model Name">
               <field name="name"/>
               <field name="partner_id"/>
               <field name="state"/>
               <field name="amount"/>
           </tree>
       </field>
   </record>
   ```

2. **Form View Template:**
   ```xml
   <record id="view_model_form" model="ir.ui.view">
       <field name="name">model.name.form</field>
       <field name="model">model.name</field>
       <field name="arch" type="xml">
           <form string="Model Name">
               <header>
                   <button name="action_confirm" type="object" string="Confirm" 
                           class="btn-primary" states="draft"/>
                   <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,done"/>
               </header>
               <sheet>
                   <group>
                       <group>
                           <field name="name"/>
                           <field name="partner_id"/>
                       </group>
                       <group>
                           <field name="date"/>
                           <field name="amount"/>
                       </group>
                   </group>
                   <notebook>
                       <page string="Lines">
                           <field name="line_ids">
                               <tree editable="bottom">
                                   <field name="product_id"/>
                                   <field name="quantity"/>
                                   <field name="price"/>
                               </tree>
                           </field>
                       </page>
                   </notebook>
               </sheet>
               <div class="oe_chatter">
                   <field name="message_follower_ids"/>
                   <field name="message_ids"/>
               </div>
           </form>
       </field>
   </record>
   ```

3. **Menu Structure:**
   ```xml
   <menuitem id="menu_main" name="Main Menu" sequence="10"/>
   <menuitem id="menu_submenu" name="Sub Menu" parent="menu_main" sequence="10"/>
   <menuitem id="menu_action" name="Model Name" parent="menu_submenu" 
             action="action_model_name" sequence="10"/>
   ```

### Security Guidelines

1. **Access Rights (ir.model.access.csv):**
   ```csv
   id,name,model_id:id,group_id:id,perm_read,perm_write,perm_create,perm_unlink
   access_model_name_user,model.name.user,model_model_name,base.group_user,1,1,1,1
   access_model_name_manager,model.name.manager,model_model_name,base.group_system,1,1,1,1
   ```

2. **Record Rules Template:**
   ```xml
   <record id="rule_model_name_user" model="ir.rule">
       <field name="name">Model Name: User Access</field>
       <field name="model_id" ref="model_model_name"/>
       <field name="domain_force">[('create_uid', '=', user.id)]</field>
       <field name="groups" eval="[(4, ref('base.group_user'))]"/>
   </record>
   ```

## Development Workflow

### Creating New Addon
1. Create addon directory in `my-addon/`
2. Create `__init__.py` and `__manifest__.py`
3. Create models, views, security files
4. Update addons path in `odoo.conf` if needed
5. Restart Odoo and install addon

### Testing Commands
```bash
# Install addon
docker-compose exec odoo odoo -i addon_name -d odoo --stop-after-init

# Update addon
docker-compose exec odoo odoo -u addon_name -d odoo --stop-after-init

# Run with debug mode
docker-compose exec odoo odoo -d odoo --dev=all

# Check logs
docker-compose logs -f odoo
```

## Best Practices

### Code Quality
- Use meaningful variable and method names
- Add docstrings to complex methods
- Use `self.ensure_one()` for singleton operations
- Always validate user inputs
- Use translation functions `_()` for user-facing strings

### Performance
- Use `@api.depends()` for computed fields
- Store computed fields when possible
- Use appropriate indexes on database fields
- Batch operations when working with multiple records

### User Experience
- Add proper field labels and help text
- Use appropriate widgets for fields
- Implement proper access rights
- Add confirmation dialogs for destructive actions
- Use proper field grouping in forms

### Error Handling
```python
from odoo.exceptions import UserError, ValidationError, AccessError

# User errors
raise UserError(_('This operation is not allowed.'))

# Validation errors
raise ValidationError(_('Field value is invalid.'))

# Access errors
raise AccessError(_('You do not have permission to perform this action.'))
```

## Integration Patterns

### With Mail Module
```python
class ModelName(models.Model):
    _name = 'model.name'
    _inherit = ['mail.thread', 'mail.activity.mixin']
    
    name = fields.Char('Name', tracking=True)
    state = fields.Selection([...], tracking=True)
```

### With Portal Module
```python
class ModelName(models.Model):
    _name = 'model.name'
    _inherit = ['portal.mixin']
    
    def _compute_access_url(self):
        for record in self:
            record.access_url = f'/my/model/{record.id}'
```

### With Website Module
```python
from odoo.http import request, route, Controller

class ModelController(Controller):
    
    @route('/my/model', auth='user', website=True)
    def portal_my_model(self):
        records = request.env['model.name'].search([])
        return request.render('addon_name.portal_template', {
            'records': records
        })
```

## Remember
- Always test addon installation and functionality
- Follow Odoo coding conventions
- Use appropriate field types and widgets
- Implement proper security measures
- Document complex business logic
- Create meaningful demo data for testing
